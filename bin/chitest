#!/usr/bin/perl
use Cwd qw(realpath);
use File::Basename;
use File::Slurp qw(read_dir);
use Getopt::Long;
use IPC::System::Simple qw(run);
use strict;
use warnings;

my $cwd = dirname(realpath($0));
my $root = realpath("$cwd/..");
my $test_class_pattern = '.';

Getopt::Long::Configure( 'pass_through' );
GetOptions(
    'c|class=s' => \$test_class_pattern,
);

my @t_files = map { "$root/t/$_" } grep { /$test_class_pattern/ && /\.t$/ } read_dir("$root/t");

chdir($root);
run("$cwd/prove", "-I$root/lib", @ARGV, @t_files);

1;
